#!/usr/bin/env python3
import re

# get function checks from code
with open('decompiled_checkFlag.c') as f:
	string = f.read()

pattern = r'iVar1 = function\d+\(.+?;'
matches = re.findall(pattern, string, flags=re.DOTALL)
print('len', len(matches))

# clean up each matched code to be one line
clean_matches = []
for i, m in enumerate(matches):
	m = m.replace(' ', '').replace('\n', '')
	clean_matches.append(m)
	
	assert('&1' in m)
	#print(i, m)

# extract important info
info_list = []
for i, m in enumerate(clean_matches):
	index = -1
	if '*pcParm1' in m:
		index = 0
	else:
		index = m.split('pcParm1[')[1].split(']')[0]
		is_hex = '0x' in index
		index = int(index, 16 if is_hex else 10)

	bit = -1
	if '>>' in m:
		bit = list(m.split('>>')[1])[0]
		bit = int(bit)
		assert 1 <= bit <= 7
	else:
		bit = 0

	func_num = m.split('function')[1].split('(')[0]
	func_num = int(func_num)

	print(i, m, index, bit, func_num)
	info = (index, bit, func_num)
	info_list.append(info)

# extract function returns using gdb
gdb_dict = {0:1,1:1,2:1,3:0,4:1,5:0,6:0,7:0,8:1,9:0,10:1,11:0,12:1,13:1,14:1,15:0,16:1,17:0,18:1,19:1,20:1,21:1,22:0,23:1,24:1,25:1,26:0,27:1,28:1,29:0,30:1,31:1,32:1,33:0,34:1,35:0,36:0,37:0,38:1,39:0,40:0,41:0,42:1,43:1,44:1,45:0,46:0,47:0,48:1,49:1,50:1,51:1,52:0,53:0,54:1,55:0,56:1,57:1,58:1,59:0,60:1,61:1,62:0,63:0,64:1,65:0,66:1,67:1,68:1,69:0,70:0,71:0,72:0,73:1,74:1,75:0,76:0,77:1,78:1,79:0,80:0,81:0,82:0,83:0,84:1,85:1,86:1,87:1,88:0,89:0,90:1,91:1,92:0,93:1,94:1,95:0,96:1,97:0,98:1,99:0,100:1,101:0,102:0,103:1,104:0,105:1,106:0,107:0,108:1,109:1,110:1,111:0,112:0,113:0,114:1,115:1,116:1,117:1,118:0,119:0,120:1,121:0,122:1,123:1,124:1,125:1,126:0,127:1,128:0,129:0,130:1,131:0,132:1,133:1,134:1,135:1,136:1,137:0,138:1,139:1,140:0,141:1,142:1,143:1,144:0,145:1,146:1,147:0,148:0,149:0,150:1,151:1,152:1,153:1,154:1,155:1,156:1,157:0,158:0,159:1,160:1,161:1,162:1,163:0,164:0,165:1,166:1,167:0,168:1,169:1,170:1,171:0,172:1,173:0,174:1,175:0,176:1,177:1,178:0,179:0,180:1,181:1,182:0,183:0,184:1,185:0,186:0,187:0,188:0,189:1,190:0,191:1,192:0,193:1,194:0,195:0,196:0,197:1,198:0,199:1,200:1,201:0,202:0,203:0,204:1,205:1,206:1,207:1,208:1,209:1,210:0,211:1,212:0,213:1,214:0,215:0,216:1,217:1,218:1,219:1,220:0,221:1,222:0,223:0,224:1,225:1,226:1,227:1,228:0,229:1,230:0,231:1,232:1,233:1,234:1,235:1,236:1,237:1,238:0,239:0,240:1,241:0,242:1,243:0,244:1,245:0,246:0,247:0,248:0,249:1,250:0,251:1,252:1,253:0,254:0,255:1,256:0,257:0,258:0,259:0,260:1,261:1,262:0,263:1,264:0,265:1,266:0,267:1,268:1,269:0,270:0,271:1,272:1,273:0,274:1,275:1,276:1,277:0,278:1,279:1,280:1,281:1,282:1,283:1,284:1,285:0,286:1,287:0,288:0,289:0,290:1,291:0,292:0,293:1,294:1,295:0,296:0,297:1,298:0,299:0,300:0,301:1,302:0,303:1,304:1,305:1,306:0,307:0,308:1,309:1,310:1,311:1,312:1,313:0,314:1,315:1,316:1,317:0,318:1,319:1,320:1,321:0,322:1,323:1,324:0,325:1,326:1,327:0,328:1,329:1,330:0,331:1,332:0,333:1,334:1,335:1,336:1,337:1,338:1,339:0,340:0,341:0,342:1,343:0,344:1,345:1,346:0,347:0,348:1,349:0,350:0,351:0,352:0,353:1,354:0,355:0,356:1,357:0,358:1,359:1,360:1,361:1,362:1,363:0,364:0,365:0,366:1,367:0,368:1,369:0,370:1,371:1,372:1,373:1,374:0,375:1,376:0,377:0,378:0,379:1,380:0,381:1,382:0,383:1,384:0,385:0,386:1,387:0,388:1,389:0,390:0,391:1,392:1,393:0,394:0,395:0,396:1,397:1,398:1,399:1,400:0,401:0,402:1,403:1,404:1,405:1,406:0,407:0,408:0,409:0,410:1,411:1,412:0,413:0,414:1,415:1,416:1,417:0,418:0,419:0,420:1,421:0,422:1,423:0,424:1,425:1,426:1,427:0,428:0,429:1,430:0,431:1,432:1,433:1,434:1,435:0,436:0,437:1,438:0,439:1,440:1,441:0,442:1,443:1,444:0,445:0,446:0,447:1,448:0,449:1,450:1,451:1,452:0,453:1,454:1,455:0,456:1,457:1,458:0,459:1,460:1,461:1,462:0,463:0,464:1,465:0,466:0,467:1,468:1,469:0,470:1,471:0,472:1,473:1,474:1,475:1,476:1,477:0,478:0,479:1,480:1,481:1,482:1,483:0,484:1,485:1,486:0,487:1,488:0,489:0,490:0,491:0,492:1,493:1,494:1,495:1,496:1,497:1,498:1,499:1,500:0,501:0,502:1,503:0,504:0,505:0,506:1,507:0,508:1,509:1,510:0,511:0,512:1,513:1,514:0,515:0,516:1,517:1,518:1,519:1,520:1,521:0,522:0,523:1,524:0,525:1,526:1,527:1,528:0,529:1,530:1,531:0,532:0,533:1,534:1,535:0,536:1,537:0,538:0,539:1,540:0,541:1,542:0,543:0,544:0,545:0,546:0,547:0,548:1,549:1,550:1,551:1,552:0,553:1,554:1,555:0,556:1,557:1,558:0,559:0,560:1,561:1,562:1,563:1,564:1,565:0,566:1,567:0,568:1,569:1,570:1,571:1,572:1,573:0,574:0,575:1,576:1,577:0,578:1,579:1,580:1,581:1,582:1,583:0,584:1,585:0,586:1,587:0,588:1,589:0,590:1,591:0,592:1,593:0,594:1,595:1,596:0,597:1,598:0,599:0,600:0,601:0,602:0,603:1,604:1,605:0,606:0,607:1,608:0,609:1,610:1,611:1,612:0,613:0,614:0,615:0,616:1,617:0,618:1,619:1,620:0,621:1,622:1,623:1,624:1,625:1,626:0,627:1,628:1,629:1,630:1,631:0,632:1,633:0,634:1,635:1,636:1,637:0,638:1,639:1,640:0,641:1,642:0,643:1,644:1,645:0,646:1,647:0,648:1,649:1,650:1,651:1,652:1,653:1,654:0,655:0,656:1,657:0,658:0,659:1,660:1,661:1,662:1,663:1,664:1,665:0,666:0,667:0,668:1,669:1,670:1,671:0,672:1,673:1,674:1,675:1,676:0,677:0,678:1,679:1,680:0,681:1,682:0,683:0,684:1,685:0,686:0,687:1,688:1,689:1,690:0,691:1,692:0,693:0,694:0,695:1,696:1,697:1,698:1,699:0,700:1,701:0,702:1,703:1,704:0,705:1,706:0,707:0,708:1,709:1,710:0,711:0,712:1,713:0,714:0,715:1,716:1,717:0,718:0,719:0,720:1,721:0,722:1,723:0,724:0,725:1,726:0,727:0,728:1,729:0,730:0,731:1,732:1,733:1,734:0,735:1,736:1,737:1,738:0,739:1,740:0,741:0,742:1,743:1,744:1,745:1,746:0,747:0,748:0,749:1,750:0,751:1,752:0,753:1,754:0,755:0,756:1,757:1,758:0,759:1,760:0,761:1,762:0,763:1,764:1,765:0,766:1,767:0,768:1,769:0,770:1,771:1,772:0,773:1,774:1,775:1,776:1,777:1,778:0,779:1,780:1,781:1,782:0,783:0,784:1,785:0,786:1,787:1,788:0,789:1,790:1,791:1,792:0,793:1,794:1,795:1,796:1,797:0,798:0,799:0,800:1,801:0,802:1,803:1,804:0,805:0,806:1,807:1,808:0,809:0,810:0,811:1,812:0,813:1,814:1,815:0,816:0,817:0,818:0,819:0,820:1,821:1,822:1,823:1,824:1,825:0,826:1,827:1,828:0,829:1,830:1,831:1}

# piece info together
bit_holder = [0] * 200
for (index, bit, func_num) in info_list:
	# print(index)
	ret_value = gdb_dict[func_num]

	if ret_value == 1:
		bit_holder[index] |= (1 << bit) 
	else:
		bit_holder[index] |= (0 << bit) 

flag = list(map(chr, bit_holder))
print(''.join(flag))
